# Frame Applications - Apache Configuration
# This file configures Apache to proxy requests to Frame instances
#
# Include this file in Apache's main configuration:
# Include /etc/apache2/conf.d/frame.conf
#
# Or for cPanel EasyApache:
# Include /etc/apache2/conf.d/includes/pre_virtualhost_global.conf

# Enable required modules
<IfModule !proxy_module>
    LoadModule proxy_module modules/mod_proxy.so
</IfModule>

<IfModule !proxy_http_module>
    LoadModule proxy_http_module modules/mod_proxy_http.so
</IfModule>

<IfModule !proxy_wstunnel_module>
    LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so
</IfModule>

<IfModule !rewrite_module>
    LoadModule rewrite_module modules/mod_rewrite.so
</IfModule>

<IfModule !headers_module>
    LoadModule headers_module modules/mod_headers.so
</IfModule>

# Frame proxy settings
<IfModule mod_proxy.c>
    # Disable forward proxy
    ProxyRequests Off

    # Preserve Host header for virtual hosting
    ProxyPreserveHost On

    # Timeout settings for Frame applications
    ProxyTimeout 300

    # Connection pool settings
    <Proxy *>
        # Connection reuse
        SetEnv proxy-nokeepalive 0
        SetEnv proxy-initial-not-pooled 1

        # Retry settings
        ProxySet retry=1
        ProxySet timeout=300
        ProxySet connectiontimeout=10
    </Proxy>
</IfModule>

# Frame-specific headers
<IfModule mod_headers.c>
    # Add Frame identifier header
    Header set X-Powered-By "Frame/1.0" env=FRAME_APP

    # Security headers for Frame apps
    Header set X-Content-Type-Options "nosniff" env=FRAME_APP
    Header set X-Frame-Options "SAMEORIGIN" env=FRAME_APP
    Header set X-XSS-Protection "1; mode=block" env=FRAME_APP
</IfModule>

# Include user-specific Frame configurations
# These are generated per-user when apps are deployed
IncludeOptional /etc/apache2/conf.d/frame/*.conf

# Include domain-specific Frame configurations
IncludeOptional /etc/apache2/conf.d/frame/domains/*.conf
